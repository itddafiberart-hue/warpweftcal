<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Weave Calculator · 경사 계산기</title>
  <meta name="theme-color" content="#f7f7fb">
  <link rel="manifest" href="manifest.webmanifest">
  <style>
    :root {
      --bg:#f7f7fb; --card:#ffffff; --text:#111; --muted:#6b7280; --accent:#0b6cf0; --mint:#DCE6ED;
      --legend-size:12px;
      --narrow-min:56px; --narrow-ideal:18vw; --narrow-max:80px;
    }
    * { box-sizing:border-box; }
    body { margin:0; font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,'Apple SD Gothic Neo','Noto Sans KR','Malgun Gothic',sans-serif; background:#f7f7fb; color:#111; overflow-x:hidden; }
    .wrap { max-width:600px; width:100%; margin:0 auto; padding:20px 12px; }
    .card { background:#ffffff; border-radius:16px; padding:18px; box-shadow:0 6px 24px rgba(0,0,0,.06); position:relative; }
    .card-head { display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:8px; }
    h1 { font-size:14px; margin:0; }
    .icon-btn { border:none; background:transparent; padding:6px; border-radius:999px; line-height:0; cursor:pointer; }
    .icon-btn:hover { background:#eef2f7; }
    .sym { display:block; font-size: calc(var(--legend-size) * 2); line-height:1; color:#667085; font-weight:400; }
    .row { display:flex; gap:6px; align-items:center; margin:8px 0; flex-wrap:nowrap; min-width:0; }
    input[type=number] { padding:8px 10px; border:1px solid #ddd; border-radius:10px; background:#fff; font-size:14px; }
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance:none; margin:0; }
    input[type=number] { -moz-appearance:textfield; }
    .narrow { width:clamp(var(--narrow-min), var(--narrow-ideal), var(--narrow-max)); flex:0 1 auto; }
    .narrow.xs { width:clamp(52px, 16vw, 72px); }
    .unit { font-weight:700; font-size:13px; }
    .muted { color:#6b7280; }
    .small { font-size:12px; }
    .radios { display:flex; flex-direction:column; align-items:flex-start; gap:6px; width:100%; }
    .radios label { display:block; width:100%; line-height:1.3; }
    fieldset { border:1px solid #eee; border-radius:12px; padding:10px; min-width:0; }
    legend { font-size:var(--legend-size); color:var(--muted); padding:0 6px; white-space:normal; }
    .result { font-size:16px; font-weight:700; padding:12px; background:#DCE6ED; border-radius:12px; display:flex; justify-content:space-between; align-items:center; width:100%; }
    .result .small { font-weight:400; }
    .badge { display:inline-block; padding:4px 8px; border-radius:999px; background:#f3f4f6; font-weight:700; font-size:14px; flex-shrink:0; }
    .equals { font-weight:700; }
    .nowrap-group { display:inline-flex; align-items:center; gap:6px; white-space:nowrap; flex-shrink:0; }
    .no-wrap-row { flex-wrap:nowrap !important; gap:4px; }
    hr { border:0; height:0; }
    .rule { border-top:1px solid rgba(107,114,128,0.15); margin:28px 0; }
    .copyright { margin-top:6px; font-size:12px; color:#9aa0a6; text-align:center; }
  </style>
</head>
<body>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('./sw.js');
      });
    }
  </script>
  <div class="wrap">
    <div class="card" id="warpCard">
      <div class="card-head">
        <h1>Weave Calculator · 경사 계산기</h1>
        <button class="icon-btn" id="resetAll" aria-label="초기화" title="초기화"><span class="sym">↻</span></button>
      </div>

      <fieldset>
        <legend>경사 밀도</legend>
        <div class="row">
          <div class="radios">
            <label><input type="radio" name="densityUnit" value="EPC" checked> <span class="unit">EPC</span> <span class="muted small">(Ends Per Centimeter)</span></label>
            <label><input type="radio" name="densityUnit" value="EPI"> <span class="unit">EPI</span> <span class="muted small">(Ends Per Inch)</span></label>
          </div>
        </div>
        <div class="row">
          <input class="narrow" id="densityValue" type="number" step="0.01" inputmode="decimal" placeholder="밀도">
          <span class="unit" id="densityUnitShort">EPC</span>
        </div>
      </fieldset>

      <fieldset style="margin-top:10px;">
        <legend>직물 폭</legend>
        <div class="row">
          <input class="narrow" id="widthValue" type="number" step="0.01" inputmode="decimal" placeholder="폭">
          <span class="unit" id="widthUnitShort">cm</span>
        </div>
      </fieldset>

      <div class="row" style="margin-top:12px;">
        <div class="result" id="warpEndsBox" style="flex-direction:column; align-items:stretch; gap:6px;">
          <div class="row" style="margin:0; justify-content:space-between; width:100%;">
            <div>필요한 경사 수</div>
            <div id="warpEnds">—</div>
          </div>
          <div class="muted small">정경할 때 경사의 올 수</div>
        </div>
      </div>

      <hr class="rule">

      <fieldset>
        <legend>직물의 총 길이 + 여유분 <span class="muted small">(마감처리, 프린지 길이 등)</span></legend>
        <div class="row no-wrap-row">
          <input class="narrow xs" id="fabricLen" type="number" step="0.01" inputmode="decimal" placeholder="길이">
          <span class="unit">cm</span>
          <span>+</span>
          <input class="narrow xs" id="allowance" type="number" step="0.01" inputmode="decimal" placeholder="여유">
          <span class="unit">cm</span>
          <span class="equals">=</span>
          <span class="nowrap-group"><span class="badge" id="lenSum">—</span><span class="unit">cm</span></span>
        </div>
      </fieldset>

      <fieldset style="margin-top:10px;">
        <legend>짜면서 줄어드는 직물 길이 수축 여유분 (%)</legend>
        <div class="row">
          <input class="narrow" id="shrinkPct" type="number" step="0.01" inputmode="decimal" placeholder="%">
          <span>%</span>
          <span class="muted small">→ 반영 길이:</span>
          <span class="nowrap-group"><span class="badge" id="shrinkLen">—</span><span class="unit">cm</span></span>
        </div>
      </fieldset>

      <fieldset style="margin-top:10px;">
        <legend>직기에 걸리는 길이 앞 + 뒤 <span class="muted small">(직기 앞, 뒤로 버려질 길이)</span></legend>
        <div class="row">
          <input class="narrow" id="loomFront" type="number" step="0.01" inputmode="decimal" placeholder="앞">
          <span class="unit">cm</span>
          <span>+</span>
          <input class="narrow" id="loomBack" type="number" step="0.01" inputmode="decimal" placeholder="뒤">
          <span class="unit">cm</span>
        </div>
      </fieldset>

      <div class="row" style="margin-top:12px;">
        <div class="result" id="warpSingleBox" style="flex-direction:column; align-items:stretch; gap:6px;">
          <div class="row" style="margin:0; justify-content:space-between; width:100%;">
            <div>경사 한 가닥의 길이</div>
            <div id="warpSingle">—</div>
          </div>
          <div class="muted small">정경할 때 경사 한 가닥의 길이,<br>결과는 작업 편의를 위해 올림(정수) 처리</div>
        </div>
      </div>

      <hr class="rule">

      <div class="row" style="margin-top:11px;">
        <div class="result" id="warpTotalBox" style="flex-direction:column; align-items:stretch; gap:6px;">
          <div class="row" style="margin:0; justify-content:space-between; width:100%;">
            <div>경사의 총 길이</div>
            <div class="nowrap-group"><span class="badge" id="warpTotalLen">—</span><span class="unit">cm</span></div>
          </div>
          <div class="muted small">작업에 소요되는 경사의 길이로 단색 경사의 계산값</div>
        </div>
      </div>

    </div>

    <p class="copyright">© STUDIO ITDA 2025. All rights reserved.</p>
  </div>

  <script>
    var densityRadios = document.querySelectorAll('input[name="densityUnit"]');
    var densityValue = document.getElementById('densityValue');
    var widthValue   = document.getElementById('widthValue');
    var densityUnitShort = document.getElementById('densityUnitShort');
    var widthUnitShort   = document.getElementById('widthUnitShort');
    var warpEnds   = document.getElementById('warpEnds');

    var fabricLen = document.getElementById('fabricLen');
    var allowance = document.getElementById('allowance');
    var lenSum    = document.getElementById('lenSum');
    var loomFront = document.getElementById('loomFront');
    var loomBack  = document.getElementById('loomBack');
    var shrinkPct = document.getElementById('shrinkPct');
    var shrinkLen = document.getElementById('shrinkLen');
    var warpSingle= document.getElementById('warpSingle');
    var warpTotalLen = document.getElementById('warpTotalLen');

    function currentDensityUnit(){
      for(var i=0; i<densityRadios.length; i++){
        if(densityRadios[i].checked) return densityRadios[i].value;
      }
      return 'EPC';
    }
    function currentLengthUnit(){ return currentDensityUnit() === 'EPC' ? 'cm' : 'in'; }

    function hasValue(inp){ return inp && String(inp.value).trim() !== ''; }
    function anyHasValue(arr){ for(var i=0;i<arr.length;i++){ if(hasValue(arr[i])) return true; } return false; }

    function toNum(v){
      var s = String(v == null ? '' : v).trim();
      if(!s) return 0;
      if(s.indexOf('.') === -1 && s.indexOf(',') !== -1){ s = s.replace(',', '.'); }
      s = s.replace(/,/g, '').replace(/\s+/g, '');
      var n = parseFloat(s);
      return isFinite(n) && n >= 0 ? n : 0;
    }
    function ceil(n){ return Math.ceil(n); }

    function updateUnits(){
      var du = currentDensityUnit();
      var lu = currentLengthUnit();
      densityUnitShort.textContent = du;
      widthUnitShort.textContent   = lu;
    }

    function computeWarpEnds(){
      var d = toNum(densityValue.value);
      var w = toNum(widthValue.value);
      return Math.ceil(d * w);
    }

    function computeWarpSingle(){
      var L = toNum(fabricLen.value);
      var A = toNum(allowance.value);
      var F = toNum(loomFront.value);
      var B = toNum(loomBack.value);
      var P = toNum(shrinkPct.value);
      var baseSumRaw = L + A;
      var shrinkRaw = baseSumRaw * (P/100);
      return Math.ceil(baseSumRaw + F + B + shrinkRaw);
    }

    function recalcWarpEnds(){
      var show = anyHasValue([densityValue, widthValue]);
      var val = computeWarpEnds();
      document.getElementById('warpEnds').textContent = show ? (val.toLocaleString('ko-KR') + ' 올') : '—';
    }

    function recalcWarpSingle(){
      var show = anyHasValue([fabricLen, allowance, loomFront, loomBack, shrinkPct]);
      var L = toNum(fabricLen.value);
      var A = toNum(allowance.value);
      var P = toNum(shrinkPct.value);
      var baseSumRaw = L + A;
      var baseSum = Math.ceil(baseSumRaw);
      var shrinkRaw = baseSumRaw * (P/100);
      var shrink = Math.ceil(shrinkRaw);
      var total = computeWarpSingle();

      document.getElementById('lenSum').textContent = baseSum.toLocaleString('ko-KR');
      document.getElementById('shrinkLen').textContent = shrink.toLocaleString('ko-KR');
      document.getElementById('warpSingle').textContent = show ? (total.toLocaleString('ko-KR') + ' cm') : '—';
    }

    function recalcTotal(){
      var endsShow = anyHasValue([densityValue, widthValue]);
      var lenShow  = anyHasValue([fabricLen, allowance, loomFront, loomBack, shrinkPct]);
      if(!endsShow || !lenShow){
        document.getElementById('warpTotalLen').textContent = '—';
        return;
      }
      var ends = computeWarpEnds();
      var single = computeWarpSingle(); // cm
      var total = ends * single;
      document.getElementById('warpTotalLen').textContent = total.toLocaleString('ko-KR');
    }

    function recalcAll(){ updateUnits(); recalcWarpEnds(); recalcWarpSingle(); recalcTotal(); }

    function wireInput(el){
      if(!el) return;
      el.addEventListener('input', recalcAll, false);
      el.addEventListener('keyup', recalcAll, false);
      el.addEventListener('change', recalcAll, false);
    }

    var densityRadios = document.querySelectorAll('input[name="densityUnit"]');
    for(var i=0;i<densityRadios.length;i++){
      densityRadios[i].addEventListener('change', recalcAll, false);
      densityRadios[i].addEventListener('click', recalcAll, false);
      densityRadios[i].addEventListener('input', recalcAll, false);
    }
    wireInput(document.getElementById('densityValue'));
    wireInput(document.getElementById('widthValue'));
    wireInput(document.getElementById('fabricLen'));
    wireInput(document.getElementById('allowance'));
    wireInput(document.getElementById('loomFront'));
    wireInput(document.getElementById('loomBack'));
    wireInput(document.getElementById('shrinkPct'));

    document.getElementById('resetAll').addEventListener('click', function(){
      for(var i=0;i<densityRadios.length;i++){ densityRadios[i].checked = (densityRadios[i].value === 'EPC'); }
      document.getElementById('densityValue').value='';
      document.getElementById('widthValue').value='';
      document.getElementById('fabricLen').value='';
      document.getElementById('allowance').value='';
      document.getElementById('shrinkPct').value='';
      document.getElementById('loomFront').value='';
      document.getElementById('loomBack').value='';
      recalcAll();
    }, false);

    recalcAll();
  </script>
</body>
</html>
